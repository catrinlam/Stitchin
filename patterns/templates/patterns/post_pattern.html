{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <h1 class="display-4">Post a New Pattern</h1>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <h3>Hooks and Needles</h3>
        {{ formset.management_form }}
        <div id="formset-container">
            {% for form in formset %}
                <div class="form-row">
                    <div class="col">
                        {{ form.type.label_tag }} {{ form.type }}
                    </div>
                    <div class="col">
                        {{ form.hook_size.label_tag }} {{ form.hook_size }}
                    </div>
                    <div class="col">
                        {{ form.needle_size.label_tag }} {{ form.needle_size }}
                    </div>
                    <div class="col">
                        {{ form.DELETE.label_tag }} {{ form.DELETE }}
                    </div>
                </div>
            {% endfor %}
        </div>
        <p>Total forms: <span id="total-forms-display">{{ formset.total_form_count }}</span></p>
        <button type="button" class="btn btn-secondary" id="add-formset">Add Hook/Needle</button>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const formsetContainer = document.getElementById('formset-container');
        const addFormsetButton = document.getElementById('add-formset');
        const totalForms = document.getElementById('id_patternhooksneedle_set-TOTAL_FORMS');
        const totalFormsDisplay = document.getElementById('total-forms-display');

        let currentFormCount = {{ formset.total_form_count }};

        console.log(totalFormsDisplay);
        console.log(currentFormCount);
        console.log(totalForms);

        addFormsetButton.addEventListener('click', function() {
            const currentFormCount = {{ formset.total_form_count }};
            const newForm = formsetContainer.children[0].cloneNode(true);
            const formRegex = RegExp(`patternhooksneedle_set-(\\d){1}-`, 'g');

            newForm.innerHTML = newForm.innerHTML.replace(formRegex, `patternhooksneedle_set-${currentFormCount}-`);
            formsetContainer.appendChild(newForm);
            totalForms.setAttribute('value', currentFormCount + 1);
            totalFormsDisplay.textContent = currentFormCount + 1;
        });
    });
    
    
</script>
{% endblock %}